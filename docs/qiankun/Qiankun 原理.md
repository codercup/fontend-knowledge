# Qiankun 原理

Qiankun 是一个基于 single-spa 框架的微前端解决方案，它旨在简化微前端开发的复杂性，提供了一套更加开箱即用的 API 和机制，使得接入和管理多个微应用变得简单。以下是 Qiankun 的核心原理概述：

1. **基于 single-spa 的封装**： Qiankun 构建在 single-spa 之上，继承了其核心功能，如路由管理和生命周期管理，但增加了更多实用特性和优化，使之更加易于使用和适应现代前端开发需求。
2. **沙箱（Sandbox）机制**： 为了实现微应用间的隔离，Qiankun 使用沙箱环境。它通过创建一个代理的`window`对象，并对全局变量进行代理或隔离，确保每个微应用的 JavaScript 执行环境独立，避免了全局变量冲突。这通常通过浅拷贝`window`对象并监控其变化来实现，以及使用`Proxy`来包裹`window`，确保微应用只能访问到自己权限内的全局变量。
3. **样式隔离**： Qiankun 利用 Shadow DOM 或者 CSS 模块化等技术来实现 CSS 隔离，确保每个微应用的样式不会污染全局样式空间，减少样式冲突。
4. **资源预加载与懒加载**： 通过资源预加载机制，Qiankun 可以在浏览器空闲时预先加载未打开的微应用资源，这加快了微应用的加载速度。它通过`import-html-entry`来解析微应用的入口文件，实现资源的智能加载。
5. **微应用注册与加载**： Qiankun 提供 API 如`registerMicroApps`来注册微应用，内部通过调用 single-spa 的方法来管理微应用的生命周期。在微应用注册时，Qiankun 会处理微应用的加载逻辑，包括异步加载微应用的 HTML、CSS 和 JavaScript 资源。
6. **生命周期管理**： 它定义了微应用的生命周期，如`mount`、`unmount`等，使得微应用可以在合适的时机启动和卸载，同时提供了一致的生命周期接口，使得开发者可以统一管理这些生命周期事件。
7. **跨域资源共享**： 为了解决微应用之间资源的跨域访问问题，Qiankun 可能需要配置相应的 CORS（跨源资源共享）策略，或者通过特定的技术手段绕过跨域限制。
8. **技术栈无关**： Qiankun 设计为技术栈无关，这意味着接入的微应用可以使用不同的前端框架或库，如 React、Vue、Angular 等，而不必担心框架之间的兼容性问题。

综上所述，Qiankun 通过一系列精心设计的机制，实现了微前端架构的核心需求：隔离性、灵活性和高性能，使得在大型企业级应用中实现模块化和解耦成为可能。
