# Qiankun 沙箱原理

Qiankun 的沙箱（Sandbox）原理是用于在微前端环境中实现应用之间的隔离，防止一个微应用对全局环境（如 `window` 对象）的修改影响到其他微应用。以下是 Qiankun 沙箱的基本工作原理：

1. **环境隔离**：
   - 当微应用被加载时，Qiankun 会创建一个沙箱环境，这个环境是一个模拟的全局环境，它与真实浏览器全局环境（如 `window` 对象）保持一致，但实际上是隔离的。
2. **全局对象的代理**：
   - Qiankun 通过 JavaScript 的 `Proxy` 对象创建一个全局对象（通常是 `window`）的代理。`Proxy` 允许在访问或修改对象属性时进行拦截，这样当微应用试图修改全局对象时，这些修改实际上是在沙箱的代理对象上进行，而不是直接修改真实的全局对象。
3. **状态保存与恢复**：
   - 在微应用挂载（`mount`）时，Qiankun 会保存当前全局环境的状态，包括 `window` 上的属性和方法。当微应用卸载（`unmount`）时，会将保存的状态应用回全局环境，确保环境回到微应用挂载前的状态，避免了不同应用之间状态的相互干扰。
4. **事件隔离**：
   - 除了属性和方法，沙箱还处理事件的隔离，确保微应用的事件监听器不会互相影响，例如，通过使用事件委托或者创建单独的事件循环来实现。
5. **样式隔离**：
   - 除了 JavaScript 的隔离，Qiankun 还提供了 CSS 隔离，这通常通过生成唯一的 CSS 前缀或者使用 CSS Modules 来实现，确保每个微应用的样式只作用于自己的 DOM 元素，避免样式冲突。
6. **生命周期管理**：
   - 沙箱也参与到微应用的生命周期管理中，确保在正确的生命周期阶段进行必要的环境设置和恢复，如在加载和卸载微应用时，启动和关闭沙箱环境。

通过以上机制，Qiankun 的沙箱能够提供一个安全的执行环境，让每个微应用在各自的沙箱内运行，互不干涉，从而保证了整体系统的稳定性和可维护性。
